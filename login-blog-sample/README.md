## Spring Login 방법 구현 샘플

---

### 주요 구현 기능
- 회원가입 기능
  - loginId, password, passwordCheck, nickname 입력
  - loginId나 nickname이 중복되면 회원가입 불가
- 로그인 기능
  - loginId, password 입력
- 로그아웃 기능
- User 정보 출력 기능
  - 회원가입한 정보를 출력
- 관리자 페이지 
  - 관리자 계정으로 회원가입 시 관리자 페이지 렌더링 가능 -> 관리자 회원가입은 DB에서 직접 추가함

---

### 쿠키 로그인 방식
- 쿠키란? : 사용자가 웹사이트 접속시 사용자의 개인 로컬에 다운로드 되고 저장되는 작은 텍스트 파일, 웹사이트는 이 쿠키를 이용해 사용자의 디바이스를 인식하고 일부 데이터를 저장하기도 한다.

- 쿠키 로그인 프로세스 : 사용자 로그인 -> 로그인 성공시 서버에서 쿠키에 사용자 정보를 담아서 응답 ->
클라이언트에서 다음에 요청을 할 때 요청에 쿠키를 담아서 서버에 보냄 -> 서버에서 쿠키를 확인하여 로그인 여부와 사용자 정보
,권한을 확인할 수 있다.

- 쿠키 생성 방법: new Cookie()를 통하여 쿠키를 생성하였고, Key Value형태로 값을 넣어주었다. setMaxAge() 메소드를 통하여 쿠키의 유효기간을 정할 수 있으며, 
이 쿠키를 응답에 추가하여 클라이언트에 보내주면 된다.

- 쿠키 확인 방법: @CookieValue 어노테이션을 통하여 클라이언트는 쿠키를 발급받은 후 유효기간 내에 자동으로 쿠키가 넘어온다. 
  - ex) @CookieValue(name = "{쿠키의 Key}", required = false) Long userId

- 쿠키 삭제 방법: 로그아웃 시 쿠키 삭제를 추가 하였고, new Cookie("{쿠키의 Key}", null)을 통하여 Value가 null인 쿠키 객체를 다시 생성하고, 
setMaxAge(0)을 통하여 유효기간을 0으로 설정해 주었다. 이를 쿠키 생성 방법과 동일하게 응답에 쿠키를 넣어서 클라이언트 측에 보내주면 쿠키를 삭제할 수 있다.

- 문제점?
  - 쿠키에 User 정보가 들어가 있는 보안의 취약점이 발생한다.
    - 예를 들어 일반 사용자는 userId가 1이고
    Admin 사용자는 userId가 2인 상태에서 관리자 도구를 통해 일반 사용자의 쿠키를 1에서 2로 변경하여 다시 요청을 보내면 관리자로 로그인이 가능한 셈이다.
    -> 다른 사람의 계정으로 로그인 된 것 처럼 사용할 수 있음.

이를 해결하기 위하여 **세션 로그인 방식**을 사용하였다.

---

### 세션 로그인 방식

- 세션 로그인 방식이란?: 일정시간 동안 같은 사용자로부터 들어오는 요구를 하나의 상태로 간주하고, 그 상태를 일정하게 유지시키는 기

- 세션 로그인 프로세스: 사용자 로그인 -> 로그인 성공시 세션을 하나 생성(세션의 Key는 중복되지 않은 랜덤 값, Value에 사용자 정보를 담음) ->
  생성한 세션을 서버의 세션 저장소에 담음 -> 세션의 Key값을 쿠키에 넣어서 클라이언트 측에게 전달 -> 사용자는 로그인을 성공하고 다른 요청을 할 때 쿠키와 함께 
  서버로 부터 받은 세션의 Key를 요청에 같이 넣어서 보냄 -> 서버 측에서 사용자에게 쿠키를 통해 세션의 Key를 받는다면, 전달 받은 Key값으로 갖는 세션을 서버 측 세션
  저장소에서 검색 -> 서버의 세션 저장소에 전달 받은 Key와 일치하는 세션이 있다면 그 세션 Key에 해당하는 Value값에는 로그인 한 사용자의 정보가 들어가 있고 이 정보를 통해서
  인증, 인가를 진행함 

- 쿠키 로그인 방식과 차이점: 세션의 Key 값이 예측이 불가능한 랜덤 값이기 때문에 다른 사용자인 것 처럼 요청을 보내는 것이 불가능하다. 하지만 동시 사용자가 많아진다면,
  서버 측에서 세션 저장소에 저장해야 할 세션이 많아진다는 단점이 존재한다. 

- 세션 생성 방법:
  - HttpServletRequest 객체에서 getSession()을 하면 Session을 가져온다. 이 때 인자로 true를 넣어 준다면(default가 true 임) 세션이 있으면 가져오고 
    없으면 세션을 생성해서 return함 => 이를 사용하여 세션을 생성하면 됨(만약 인자로 false를 넣어 준다면 세션이 있으면 가져오고 없으면 null을 return)
    - ```java
      // 세션이 있으면 가져 오고 없으면 세션을 생성해서 return (default = true)
      HttpSession session = httpServeltRequest.getSession(true);
      // 새션이 있으면 가져 오고 없으면 null을 return
      HttpSession session = httpServletRequest.getSession(false);
      ```
  
  -  세션을 생성한 후 .setAttribute()를 통해서 세션의 Key와 Value를 넣어줄 수 있다.
     - ```java
       session.setAttribute("userId", user.getId());
       // Session의 유효 시간 설정 (1800초 = 30분)
       session.setMaxInactiveInterval(1800);  
       ```
     
- 세션 확인 방법:
- 세션 삭제 방법:
  - ```java
    HttpSession session = request.getSession(false);
    session.invalidate();
    ```